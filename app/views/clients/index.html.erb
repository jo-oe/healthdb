<h1 class="h1client"><%= t(:clients) %></h1>

<% if (notice) %>
  <p id="notice"><%= notice %></p>
<% end %>

<%= form_tag(clients_path, { :method => "get", :autocomplete => "off", :id => "client_searchform"}) %>

<ul><li><%= link_to 'Angezeigte Stammdatensätze in Excel-Tabelle für eigene Statistik exportieren', clients_path(request.parameters.merge({:format => :xls})) %></li><ul>

<table class='clienttable'>
  <thead>
    <tr>
      <th colspan="4"></th>
      <th class="rotate"><div><span><%= label(:client, :id) %></span></div></th>
      <th class="rotate"><div><span><%= label(:client, :lastname) %></span></div></th>
      <th class="rotate"><div><span><%= label(:client, :firstname) %></span></div></th>
      <th class="rotate"><div><span><%= label(:client, :birthdate) %></span></div></th>
      <th class="rotate"><div><span><%= label(:client, :sex) %></span></div></th>
      <th class="rotate"><div><span><%= label(:client, :homeplace) %></span></div></th>
      <th class="rotate"><div><span><%= label(:client, :citizenship) %></span></div></th>
      <th class="rotate"><div><span><%= label(:client, :legalstatus) %></span></div></th>
      <th class="rotate"><div><span><%= label(:client, :familystatus) %></span></div></th>
      <th class="rotate"><div><span><%= label(:client, :childrencount) %></span></div></th>
      <th class="rotate"><div><span><%= label(:client, :datefirstcontact) %></span></div></th>
      <th class="rotate"><div><span><%= label(:client, :referrer) %></span></div></th>
      <th class="rotate"><div><span><%= label(:client, :referrerfreetext) %></span></div></th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td colspan="4" class="hdb-clientsearch-buttons">
        <%= link_to t(:reset_search), clients_path, class: 'btn btn-sm btn-hdb-std btn-resetsearch' %>
        <%= submit_tag t(:search_for), class: 'btn btn-sm btn-hdb-std btn-search' %>
        <%= hidden_field_tag :filter, "yes" %>
      </td>
      <td class="hdb-search-field"><%= text_field_tag :id, params[:id], class: "form-control hdb-search-input" %></td>
      <td class="hdb-search-field"><%= text_field_tag :lastname, params[:lastname], class: "form-control hdb-search-input" %></td>
      <td class="hdb-search-field"><%= text_field_tag :firstname, params[:firstname], class: "form-control hdb-search-input" %></td>
      <td class="hdb-search-field">
        <table class="hdb-searchform-minitable">
          <tr class="hdb-searchform-row">
            <td class="hdb-searchform-checkbox"><%= check_box_tag :birthdate_selectrange, true, params[:birthdate_selectrange] %></td>
            <td class="hdb-searchform-checkboxlabel"><%= label :client, :birthdate_selectrange, class: "hdb-search-label" %></td>
          </tr>
          <tr class="hdb-searchform-row">
            <td colspan="2" class="hdb-search-subfield"><%= date_field_tag :birthdate_rangestart, params[:birthdate_rangestart], class: "form-control hdb-search-input" %></td>
          </tr>
          <tr class="hdb-searchform-row">
            <td colspan="2" class="hdb-search-subfield"><%= date_field_tag :birthdate_rangeend, params[:birthdate_rangeend], class: "form-control hdb-search-input" %></td>
          </tr>
        </table>
      </td>
      <td class="hdb-search-field"><%= text_field_tag :sex_id, params[:sex_id], class: "form-control hdb-search-input" %></td>
      <td class="hdb-search-field"><%= text_field_tag :homeplace_id, params[:homeplace_id], class: "form-control hdb-search-input" %></td>
      <td class="hdb-search-field">
        <table class="hdb-searchform-minitable">
          <tr class="hdb-searchform-row">
            <td class="hdb-searchform-checkbox"><%= check_box_tag :citizenship_select, true, params[:citizenship_select] %></td>
            <td class="hdb-searchform-checkboxlabel"><%= label :client, :citizenship_select, class: "hdb-search-label" %></td>
          </tr>
          <tr class="hdb-searchform-row">
            <td colspan="2" class="hdb-search-subfield" id="citizenship_searchfield"><%= text_field_tag :citizenship, params[:citizenship], id: "citizenship_searchinput", placeholder: 'Staat', class: "form-control typeahead hdb-search-input" %></td>
          </tr>
          <tr class="hdb-searchform-row">
            <td colspan="2" class="hdb-search-subfield"><%= select_tag :citizenship_id, options_from_collection_for_select(Citizenship.all, :id, :id, :citizenship_id), { :class => 'form-control hdb-form-input'} %></td>
          </tr>
        </table>
      </td>
      <td class="hdb-search-field"><%= text_field_tag :legalstatus_id, params[:legalstatus_id], class: "form-control hdb-search-input" %></td>
      <td class="hdb-search-field"><%= text_field_tag :familystatus_id, params[:familystatus_id], class: "form-control hdb-search-input" %></td>
      <td class="hdb-search-field"><%= text_field_tag :childrencount, params[:childrencount], class: "form-control hdb-search-input" %></td>
      <td class="hdb-search-field">
        <table class="hdb-searchform-minitable">
          <tr class="hdb-searchform-row">
            <td class="hdb-searchform-checkbox"><%= check_box_tag :datefirstcontact_selectrange, true, params[:datefirstcontact_selectrange] %></td>
            <td class="hdb-searchform-checkboxlabel"><%= label :client, :datefirstcontact_selectrange, class: "hdb-search-label" %></td>
          </tr>
          <tr class="hdb-searchform-row">
            <td colspan="2" class="hdb-search-subfield"><%= date_field_tag :datefirstcontact_rangestart, params[:datefirstcontact_rangestart], class: "form-control hdb-search-input" %></td>
          </tr>
          <tr class="hdb-searchform-row">
            <td colspan="2" class="hdb-search-subfield"><%= date_field_tag :datefirstcontact_rangeend, params[:datefirstcontact_rangeend], class: "form-control hdb-search-input" %></td>
          </tr>
        </table>
      </td>
      <td class="hdb-search-field"><%= text_field_tag :referrer_id, params[:referrer_id], class: "form-control hdb-search-input" %></td>
      <td class="hdb-search-field"><%= text_field_tag :referrerfreetext, params[:referrerfreetext], class: "form-control hdb-search-input" %></td>
    </tr>

    <% @clients.each do |client| %>
      <tr>
        <td><%= link_to t(:edit_client), edit_client_path(client), class: 'btn btn-table-mini btn-client-edit' %></td>
        <td><%= link_to t(:add_contact), new_contact_path(:client_id => client.id), class: 'btn btn-table-mini btn-contact-new' %></td>
        <td><%= link_to t(:list_contacts), contacts_path(:client_id => client.id), class: 'btn btn-table-mini btn-contact-edit'  %></td>
        <td><%= link_to t(:destroy), client, method: :delete, data: { confirm: t(:deleteclientconfirm) }, class: 'btn btn-table-mini btn-client-delete' %></td>
        <td><%= client.id %></td>
        <td><%= client.lastname %></td>
        <td><%= client.firstname %></td>
        <td><%= client.birthdate %></td>
        <td><%= client.sex.id %></td>
        <td><%= client.homeplace.id %></td>
        <td><%= client.citizenship.id %></td>
        <td><%= client.legalstatus.id %></td>
        <td><%= client.familystatus.id %></td>
        <td><%= client.childrencount %></td>
        <td><%= client.datefirstcontact %></td>
        <td><%= client.referrer.id %></td>
        <td><%= client.referrerfreetext %></td>
      </tr>
    <% end %>
  </tbody>
</table>
